<h1>A (last) diversion</h1>

<p>On the threshold of my (long) weekend I received a call from a colleague who asked me about adding time zone data to D&amp;B Direct+ data. An interesting question I had never heard before. We discussed a couple of implementation alternatives mainly related to translating country(/state) data to time zones. Certainly a lot of work but not really challenging from a technical point of view. After a good night sleep the question popped into my head again and I thought it would be interesting to check if there are any web service solutions available on the Internet. It was not long before I found a useful <a href="https://stackoverflow.com/questions/16086962/how-to-get-a-time-zone-from-a-location-using-latitude-and-longitude-coordinates" title="Determine the time zone in a location">Stackoverflow article</a> which referred me to the <a href="https://developers.google.com/maps/documentation/timezone/intro" title="Google maps Time Zone API">Google Maps Time Zone API</a>.</p>

<p>I always perform a quick test in my <a href="https://addons.mozilla.org/nl/firefox/addon/restclient/" title="A debugger for RESTful web services">Firefox RESTClient</a> before implementing an API. The test basically confirmed that the Google Maps Time Zone API is really very simple. The only thing, at this stage, which tripped me up was that I needed to enable the API in my <a href="https://console.cloud.google.com/" title="Google Cloud platform">Google Cloud Platform Console</a> and, with that out of the way, executing the test was a breeze.</p>

<p>I implemented <a href="https://hdr.is-a-geek.com/svn/dnbdpl/node.js/ggl_tmz.js" title="NodeJS Google time zone API wrapper">class GoogleTmz</a> as a first step towards a working prototype. The design pattern should be familiar by now but please be aware that I would describe the status of the code as "proof-of-concept" (i.e. no persistence, no automatic key updates, etc.). The API wrapper makes calling the Google Time Zone API in NodeJS as easy as:</p>

<p><img src="./assets/imgs/ggl_tmz_obj.png" alt="Google time zone object code"></p>

<p>In the code above a GoogleTmz object is instantiated and, as soon as the API response is available, a couple of object properties are echoed to the screen:</p>

<p><img src="./assets/imgs/ggl_tmz_out.png" alt="Google time zone object output"></p>

<p>In the test I chose the latitude/longitude combination mentioned for a reason. These values are the values as they appear in the Direct+ data packet for Agglo-Bouw (DUNS 407809623, a fictitious example record).</p>

<p><img src="./assets/imgs/dpl_lat_long.png" alt="Geo position attributes in Direct+ CMPELK"></p>

<p>To complete the prototype I implemented <a href="https://hdr.is-a-geek.com/svn/dnbdpl/node.js/ggl_tmz.js" title="NodeJS Direct+ CMPELK and Google time zone wrapper">class DplTmzProduct</a> as well. In this class the Direct+ &amp; Google time zone data are brought together. In my <a class="blog_prev" href="./prev" title="Previous blog post">previous post</a> I combined data from two D&amp;B APIs. Consequently I could fire off the calls in parallel. However, in the case of the Google time zone API, data from the Direct+ response is used as input in the time zone request. The logic of class DplTmzProduct therefore is strictly sequential.</p>

<p><img src="./assets/imgs/dpl_incl_tmz_code.png" alt="Class DplTmzProduct onLoad CMPELK"></p>

<p>The JSON generated by the following custom object instantiation:</p>

<p><img src="./assets/imgs/dpl_tmz_obj.png" alt="Direct+ including time zone object instantiation"></p>

<p>contains, besides the D&amp;B Direct+ information, an additional property, gglTmz, with the relevant time zone data sourced from Google!</p>

<p><img src="./assets/imgs/dpl_tmz_json.png" alt="Direct+ data including additional property gglTmz"></p>
