<h1>Docker Compose, adding Node.js</h1>

<p>In my <a class="blog_prev" href="./prev" title="Previous blog post">previous post</a> I made my Apache container (more <a class="blog_anchor" title="Running Apache in a container" href="docker_pt2.html">here</a>, <a class="blog_anchor" title="Adding HTTPS to Dockerized Apache" href="docker_pt3.html">here</a> &amp; <a class="blog_anchor" title="Adding SSL client authentication to Dockerized Apache" href="docker_pt4.html">here</a>) part of a Docker Compose project. From a purely functional perspective this added nothing because Docker Compose is a tool for defining &amp; running multi-container applications. In this blog post I will add a second container to the project and that will make it come to life.</p>

<p>The container which I will add is a Node.js application based on the <a class="blog_anchor" title="Getting started with Docker" href="docker_pt1.html">first Docker container</a> I ever built (full disclosure, of course it all started with <a href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/" title="Dockerizing a Node.js web app">this example</a>). At this stage the number of lines of <a href="https://hdr.is-a-geek.com/svn/dnb_dpl_v2/node/src/dnb_dpl_ws.js?p=4" title="Node.js Express endpoints for customized D&amp;B Direct+ API">JavaScript code</a> is still very limited. Please stay tuned however because, in the next few posts, I will port back most of the functionality implemented in the <a href="https://hdr.is-a-geek.com/svn/dnbdpl/node.js/dnb_dpl_ws.js" title="Previous version of dnb_dpl_ws.js">previous version</a> of this file.</p>

<p>To add the Node.js container issue, with directory dnb_dpl_v2 as the active directory, the following command: <code>mkdir node &amp;&amp; cd $_</code>Next create, in directory node, this <a href="https://hdr.is-a-geek.com/svn/dnb_dpl_v2/node/Dockerfile?p=4" title="Node.js Dockerfile">Dockerfile</a>. All the other files associated with the Node.js Docker container are stored in directory src: <code>mkdir src &amp;&amp; cd $_</code>In directory src first create an empty file named package-lock.json: <code>touch package-lock.json</code>Finally create the files <a href="https://hdr.is-a-geek.com/svn/dnb_dpl_v2/node/src/package.json?p=4" title="npm configuration file">package.json</a> &amp; <a href="https://hdr.is-a-geek.com/svn/dnb_dpl_v2/node/src/dnb_dpl_ws.js?p=4" title="Node.js Express endpoints for customized D&amp;B Direct+ API">dnb_dpl_ws.js</a> and that's all there is to the Node.js Docker container!</p>

<p>With everything related to the additional container in place, go back to the project's top level directory: <code>cd ../..</code>and edit file docker-compose.yml. Add the following lines to the end of this file:</p>

<div class="ghgist" data-ghgistid="faef1a869cc6bd3c06b0b52ed1c9b2d6"></div>

<p>You can check the entirety of your docker-compose.yml file <a href="https://hdr.is-a-geek.com/svn/dnb_dpl_v2/docker-compose.yml?p=4" title="Main Docker Compose configuration file">here</a>.</p>

<p>One of the strong points of Docker Compose is the ease with which interconnections between containers can be made. In my project this is effectuated in the Apache container. So, first switch over to the Apache configuration directory: <code>cd apache2/conf</code>and edit file httpd.conf in order to enable the proxy modules. This can be done by unremarking these lines: <img src="./assets/imgs/dkr_enbl_prx_mods.png" alt="Enable the Apache proxy modules">With modules mod_proxy and mod_proxy_http enabled, the reverse proxy can be configured on file httpd-ssl.conf. The righthand side part of the picture below shows the correct settings to accomplish this: <img src="./assets/imgs/dkr_prx_mods_conf.png" alt="Define the specifics of the reverse proxy"> It's interesting to note the similarities between the instructions above and those in this <a class="blog_anchor" title="Apache configured as a reverse proxy" href="ws_run_pt3.html">blog post</a>. Obviously the biggest difference is the server reference. In the new configuration "dnb_dpl_node", a service defined in the .yml file, is referenced where previously "localhost" was used. The inner workings of Docker Compose networks are explained pretty well in this part of the <a href="https://youtu.be/4EqysCR3mjo?t=906">YouTube video</a> which I already recommended in my previous post.</p>

<p>The Docker Compose application can now be run. In the directory which contains the file docker-compose.yml (i.e. the project's top level directory dnb_dpl_v2) execute:</p>

<div class="ghgist" data-ghgistid="6bab0d8df409d7340885cc04927f4152"></div>

<p>If you now access URL: <code>https://host.example.org:&lt;port&gt;/dnb/</code>You should see the JSON as returned from file dnb_dpl_ws.js: <img src="./assets/imgs/dkr_prx_ret.png" alt="Docker Compose application return"></p>
